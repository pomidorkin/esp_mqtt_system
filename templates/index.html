{% extends "base.html" %}

{% block title %}–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ - ESP Manager{% endblock %}
{% block header %}üì± –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞{% endblock %}
{% block subtitle %}–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ESP —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —á–µ—Ä–µ–∑ MQTT{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number" id="total-devices">0</div>
            <div class="stat-label">–í—Å–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="online-devices">0</div>
            <div class="stat-label">–û–Ω–ª–∞–π–Ω</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="device-types">0</div>
            <div class="stat-label">–¢–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-primary" onclick="refreshDevices()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        <button class="btn btn-secondary" onclick="discoverDevices()">üîç –ü–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤</button>
        <button class="btn btn-info" onclick="sendToAll('STATUS')">üì° –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã</button>
    </div>

    <div class="devices-container">
        <h3>üìã –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤</h3>
        <div id="devices-list" class="devices-list">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤...</div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
function sendToAll(command) {
    fetch('/api/broadcast', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({command: command})
    })
    .then(response => response.json())
    .then(data => {
        showNotification(`–ö–æ–º–∞–Ω–¥–∞ ${command} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤—Å–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º`, 'success');
        refreshDevices();
    });
}
</script>
{% endblock %}